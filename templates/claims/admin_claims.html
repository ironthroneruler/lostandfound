{% extends 'base.html' %}
{% block title %}Manage Reports, Claims, and Inquiries{% endblock %}
{% block content %}

<div class="page-header">
    <h1><i class="fas fa-tasks"></i> Manage Reports, Claims, and Inquiries</h1>
    <p class="text-muted">Review and process item reports, student claims and inquiries</p>
</div>

<!-- Filter Tabs -->
<div class="admin-tabs-container">
    <div class="admin-tabs">
        <a href="?status=pending_approval" class="admin-tab {% if current_filter == 'pending_approval' %}active-tab{% endif %}">
            <i class="fas fa-exclamation-triangle"></i> Pending Approval
            {% if counts.pending_approval > 0 %}
            <span class="count-badge">{{ counts.pending_approval }}</span>
            {% endif %}
        </a>
        <a href="?status=pending" class="admin-tab {% if current_filter == 'pending' %}active-tab{% endif %}">
            Pending Claims
            {% if counts.pending > 0 %}
            <span class="count-badge">{{ counts.pending }}</span>
            {% endif %}
        </a>
        <a href="?status=approved" class="admin-tab {% if current_filter == 'approved' %}active-tab{% endif %}">
            Approved
            {% if counts.approved > 0 %}
            <span class="count-badge">{{ counts.approved }}</span>
            {% endif %}
        </a>
        <a href="?status=rejected" class="admin-tab {% if current_filter == 'rejected' %}active-tab{% endif %}">
            Rejected
            {% if counts.rejected > 0 %}
            <span class="count-badge">{{ counts.rejected }}</span>
            {% endif %}
        </a>
        <a href="?status=completed" class="admin-tab {% if current_filter == 'completed' %}active-tab{% endif %}">
            Completed
            {% if counts.completed > 0 %}
            <span class="count-badge">{{ counts.completed }}</span>
            {% endif %}
        </a>
        <a href="?status=all" class="admin-tab {% if current_filter == 'all' %}active-tab{% endif %}">
            All
            {% if counts.all > 0 %}
            <span class="count-badge">{{ counts.all }}</span>
            {% endif %}
        </a>
    </div>
</div>

{% if current_filter == 'pending_approval' %}
    <!-- Pending Approval Items Section -->
    {% if pending_approval_items %}
        <div class="admin-items-grid">
            {% for item in pending_approval_items %}
            <div class="admin-item-card pending-item">
                <div class="item-status-badge">
                    <span class="status-badge status-reported">
                        <i class="fas fa-exclamation-triangle"></i> Pending
                    </span>
                </div>

                {% if item.photo %}
                <div class="item-photo-container">
                    <img src="{{ item.photo.url }}" alt="{{ item.name }}" class="item-photo">
                </div>
                {% endif %}

                <h3 class="item-title">
                    {{ item.name }}
                    <span class="item-id-badge">ID: {{ item.id }}</span>
                </h3>

                <div class="item-details">
                    <p class="item-detail-row">
                        <strong><i class="fas fa-tag"></i> Category:</strong> {{ item.get_category_display }}
                    </p>
                    <p class="item-detail-row">
                        <strong><i class="fas fa-map-marker-alt"></i> Location:</strong> {{ item.location_found }}
                    </p>
                    <p class="item-detail-row">
                        <strong><i class="fas fa-calendar"></i> Date Found:</strong> {{ item.date_found }}
                    </p>
                    <p class="item-detail-row">
                        <strong><i class="fas fa-user"></i> Reported by:</strong> {{ item.submitted_by.get_full_name|default:item.submitted_by.username }}
                    </p>
                    <p class="item-detail-row item-time">
                        <i class="fas fa-clock"></i> {{ item.created_at|timesince }} ago
                    </p>
                </div>

                {% if item.description %}
                <div class="item-description-box">
                    <strong>Description:</strong><br>{{ item.description }}
                </div>
                {% endif %}

                <div class="item-actions">
                    <a href="{% url 'item_detail' item.pk %}" class="btn btn-primary btn-flex">
                        <i class="fas fa-eye"></i> View Details
                    </a>
                    <a href="{% url 'approve_item' item.pk %}" class="btn btn-success btn-flex">
                        <i class="fas fa-check-circle"></i> Approve
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <i class="fas fa-check-circle"></i>
            <h2>No Items Pending Approval</h2>
            <p>All reported items have been processed</p>
        </div>
    {% endif %}
{% else %}
    <!-- Claims Section -->
    {% if claims %}
        <div class="claims-list">
            {% for claim in claims %}
            <div class="claim-card">
                <div class="claim-content">
                    <div class="claim-info">
                        <h3 class="claim-title">
                            {{ claim.item.name }}
                            <span class="item-id-badge">ID: {{ claim.item.id }}</span>
                            <span class="claim-type-label">({{ claim.get_claim_type_display }})</span>
                        </h3>
                        <p class="claim-detail">
                            <strong>Claimant:</strong> {{ claim.claimant.get_full_name|default:claim.claimant.username }}
                            ({{ claim.claimant.email }})
                        </p>
                        <p class="claim-detail">
                            <strong>Contact:</strong> {{ claim.contact_method }}
                        </p>
                        <div class="claim-description-box">
                            <strong>Description:</strong> {{ claim.description }}
                        </div>
                        {% if claim.additional_proof %}
                        <div class="claim-proof-box">
                            <strong>Additional Proof:</strong> {{ claim.additional_proof }}
                        </div>
                        {% endif %}
                        <p class="claim-time">
                            <i class="fas fa-clock"></i> Submitted {{ claim.created_at|timesince }} ago
                        </p>
                        {% if claim.status == 'completed' and claim.item.returned_to %}
                        <div class="claim-returned-box">
                            <strong><i class="fas fa-user-check"></i> Returned to:</strong>
                            <span>{{ claim.item.returned_to.get_full_name|default:claim.item.returned_to.username }}</span>
                            <br><small>{{ claim.item.returned_to.email }}</small>
                        </div>
                        {% endif %}
                    </div>

                    <div class="claim-actions-panel">
                        <span class="status-badge status-{{ claim.status }}">
                            {{ claim.get_status_display }}
                        </span>
                        <div class="claim-buttons">
                            <a href="{% url 'review_claim' claim.pk %}" class="btn btn-primary btn-block">
                                <i class="fas fa-gavel"></i> Review
                            </a>
                            <a href="{% url 'item_detail' claim.item.pk %}" class="btn btn-outline-secondary btn-block">
                                <i class="fas fa-eye"></i> View Item
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <h2>No Claims Found</h2>
            <p>No claims match the selected filter</p>
        </div>
    {% endif %}
{% endif %}

{% endblock %}